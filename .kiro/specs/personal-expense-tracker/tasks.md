# 實作計畫：個人記帳本

## 概述

本實作計畫將個人記帳本分解為漸進式的開發步驟。每個任務都建立在前一個任務的基礎上，最終整合成一個完整的應用程式。專案僅使用三個檔案（index.html、style.css、script.js），不使用任何外部框架或建置工具。

## 任務清單

- [x] 1. 建立專案結構和基本 HTML 骨架
  - 建立 index.html、style.css、script.js 三個檔案
  - 在 index.html 中建立基本結構：標題、輸入區域、清單容器、總計顯示
  - 確保 HTML 正確引用 CSS 和 JavaScript 檔案
  - 包含所有必要的 id 屬性：amountInput、categorySelect、addBtn、expenseList
  - _需求：1.1, 1.2, 2.1, 2.2, 2.3, 2.5, 2.6_

- [x] 1.1 撰寫單元測試驗證 DOM 元素存在性
  - 測試所有必要的 DOM 元素是否存在
  - 測試類別下拉選單包含正確的三個選項
  - _需求：2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 2. 實作基本 CSS 樣式
  - [x] 2.1 設定頁面基本樣式
    - 淺灰色背景
    - 容器置中和適當的寬度
    - 字體和顏色設定
    - _需求：3.1_
  
  - [x] 2.2 設計輸入區域樣式
    - 輸入欄位和下拉選單的樣式
    - 綠色新增按鈕
    - 圓角和間距
    - _需求：3.2, 3.3, 3.4_
  
  - [x] 2.3 設計清單和總計顯示樣式
    - 清單項目的樣式
    - 刪除按鈕樣式
    - 總計顯示的樣式
    - _需求：3.4_
  
  - [x] 2.4 實作響應式設計
    - 使用媒體查詢調整小螢幕佈局
    - 確保在行動裝置上易於使用
    - _需求：3.5_

- [x] 3. 實作資料結構和 localStorage 函式
  - [x] 3.1 定義支出記錄資料結構
    - 建立支出記錄物件格式（id、amount、category）
    - 初始化全域資料陣列
    - _需求：5.5_
  
  - [x] 3.2 實作 localStorage 儲存函式
    - 實作 saveToLocalStorage() 函式
    - 將陣列序列化為 JSON 並儲存
    - 處理儲存錯誤
    - _需求：5.1_
  
  - [x] 3.3 實作 localStorage 載入函式
    - 實作 loadFromLocalStorage() 函式
    - 從 localStorage 讀取並解析 JSON
    - 處理空值和解析錯誤
    - _需求：5.2_

- [x] 3.4 撰寫屬性測試：localStorage 往返一致性
  - **屬性 5：localStorage 往返一致性**
  - **驗證需求：5.5**
  - 生成隨機支出記錄陣列，儲存後載入，驗證資料一致性

- [x] 4. 實作今日總計計算功能
  - [x] 4.1 實作 calculateTotal() 函式
    - 遍歷所有支出記錄並計算總和
    - 返回總金額
    - _需求：7.6_
  
  - [x] 4.2 實作 updateTotalDisplay() 函式
    - 呼叫 calculateTotal() 取得總額
    - 更新 DOM 顯示「今日總計：XXX 元」
    - _需求：7.1, 7.2_

- [x] 4.3 撰寫屬性測試：今日總計計算正確性
  - **屬性 9：今日總計計算正確性**
  - **驗證需求：7.6, 7.2**
  - 生成隨機支出記錄集合，驗證總計等於所有金額總和

- [x] 4.4 撰寫單元測試：空清單顯示零元
  - 測試當沒有記錄時顯示「今日總計：0 元」
  - _需求：7.5_

- [x] 5. 實作新增支出功能
  - [x] 5.1 實作輸入驗證函式
    - 實作 validateInput() 函式
    - 檢查金額是否為空或 <= 0
    - 返回驗證結果和錯誤訊息
    - _需求：4.3, 4.4_
  
  - [x] 5.2 實作 addExpense() 函式
    - 取得輸入值並驗證
    - 建立新的支出記錄物件（使用 Date.now() 作為 id）
    - 將記錄加入資料陣列
    - 呼叫 saveToLocalStorage()
    - 呼叫 renderExpense() 顯示新記錄
    - 清空輸入欄位並重置下拉選單
    - 呼叫 updateTotalDisplay()
    - _需求：4.1, 4.5, 4.6, 5.1, 7.3_
  
  - [x] 5.3 綁定新增按鈕事件監聽器
    - 在 init() 函式中綁定 addBtn 的 click 事件
    - _需求：4.1_

- [x] 5.4 撰寫屬性測試：新增有效記錄增加清單長度
  - **屬性 1：新增有效記錄增加清單長度**
  - **驗證需求：4.1**
  - 生成隨機有效金額和類別，驗證新增後清單長度增加 1

- [x] 5.5 撰寫屬性測試：拒絕無效金額
  - **屬性 3：拒絕無效金額**
  - **驗證需求：4.3**
  - 生成隨機的 <= 0 金額，驗證系統拒絕並保持清單不變

- [x] 5.6 撰寫屬性測試：成功新增後清空輸入
  - **屬性 4：成功新增後清空輸入**
  - **驗證需求：4.5, 4.6**
  - 驗證新增後輸入欄位被清空且下拉選單重置

- [x] 5.7 撰寫屬性測試：新增操作立即持久化
  - **屬性 6：新增操作立即持久化**
  - **驗證需求：5.1**
  - 驗證新增記錄後 localStorage 立即包含該記錄

- [x] 6. 檢查點 - 確保新增功能正常運作
  - 確保所有測試通過，如有問題請詢問使用者

- [x] 7. 實作顯示支出記錄功能
  - [x] 7.1 實作 renderExpense() 函式
    - 建立 DOM 元素顯示「分類 - 金額 元」
    - 建立刪除按鈕並綁定事件
    - 將元素插入 expenseList 容器
    - _需求：4.2, 6.1_
  
  - [x] 7.2 實作 renderAllExpenses() 函式
    - 清空 expenseList 容器
    - 遍歷資料陣列並呼叫 renderExpense()
    - _需求：5.3_

- [x] 7.3 撰寫屬性測試：顯示格式正確性
  - **屬性 2：顯示格式正確性**
  - **驗證需求：4.2**
  - 生成隨機支出記錄，驗證顯示文字符合「分類 - 金額 元」格式

- [x] 7.4 撰寫屬性測試：每筆記錄都有刪除按鈕
  - **屬性 8：每筆記錄都有刪除按鈕**
  - **驗證需求：6.1**
  - 驗證所有顯示的記錄都有對應的刪除按鈕

- [x] 8. 實作刪除支出功能
  - [x] 8.1 實作 deleteExpense() 函式
    - 根據 id 從資料陣列中移除記錄
    - 呼叫 saveToLocalStorage()
    - 從 DOM 中移除對應元素
    - 呼叫 updateTotalDisplay()
    - _需求：6.2, 6.3, 6.4_
  
  - [x] 8.2 在 renderExpense() 中綁定刪除按鈕事件
    - 為每個刪除按鈕綁定 click 事件
    - 呼叫 deleteExpense() 並傳入記錄 id
    - _需求：6.2_

- [x] 8.3 撰寫屬性測試：刪除操作同步更新
  - **屬性 7：刪除操作同步更新**
  - **驗證需求：6.2, 6.3, 5.4**
  - 驗證刪除後記錄從顯示、資料陣列和 localStorage 中同時移除

- [x] 8.4 撰寫屬性測試：刪除後總計即時更新
  - **屬性 10：新增和刪除後總計即時更新**
  - **驗證需求：7.3, 6.4**
  - 驗證新增或刪除操作後總計立即更新

- [x] 9. 實作初始化和頁面載入邏輯
  - [x] 9.1 實作 init() 函式
    - 呼叫 loadFromLocalStorage() 載入資料
    - 呼叫 renderAllExpenses() 顯示所有記錄
    - 呼叫 updateTotalDisplay() 顯示總計
    - 綁定所有事件監聽器
    - _需求：5.2, 5.3, 7.2_
  
  - [x] 9.2 在 DOMContentLoaded 事件中呼叫 init()
    - 確保 DOM 完全載入後才執行初始化
    - _需求：5.2_

- [x] 9.3 撰寫屬性測試：頁面載入時正確顯示資料
  - **屬性 11：頁面載入時正確顯示資料**
  - **驗證需求：5.2, 5.3, 7.2**
  - 預設 localStorage 資料，驗證頁面載入後正確顯示所有記錄和總計

- [x] 10. 最終檢查點和整合測試
  - [x] 10.1 測試完整的新增流程
    - 輸入 → 新增 → 顯示 → 持久化
    - _需求：4.1, 5.1, 7.3_
  
  - [x] 10.2 測試完整的刪除流程
    - 刪除 → 更新顯示 → 更新 localStorage → 更新總計
    - _需求：6.2, 6.3, 6.4_
  
  - [x] 10.3 測試頁面重新載入
    - 新增記錄 → 重新整理頁面 → 驗證資料保留
    - _需求：5.2, 5.3_
  
  - [x] 10.4 測試響應式設計
    - 在不同螢幕尺寸下測試介面
    - _需求：3.5_
  
  - [x] 10.5 測試錯誤處理
    - 測試無效輸入的警告訊息
    - 測試 localStorage 錯誤處理
    - _需求：4.3, 4.4_

- [x] 11. 最終檢查點 - 確保所有測試通過
  - 確保所有測試通過，如有問題請詢問使用者

## 注意事項

- 標記 `*` 的任務為可選任務，可以跳過以加快 MVP 開發
- 每個任務都引用特定需求以確保可追溯性
- 檢查點確保漸進式驗證
- 屬性測試驗證通用正確性屬性
- 單元測試驗證特定範例和邊界情況
