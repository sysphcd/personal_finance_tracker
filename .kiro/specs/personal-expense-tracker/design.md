# 設計文件

## 概述

個人記帳本是一個純前端的網頁應用程式，使用 HTML、CSS 和 JavaScript 實作。應用程式允許使用者新增、刪除和查看支出記錄，並使用瀏覽器的 localStorage 進行資料持久化。介面設計簡潔、響應式，適合桌面和行動裝置使用。

## 架構

### 檔案結構

```
project-root/
├── index.html      # 主要 HTML 結構
├── style.css       # 所有樣式定義
└── script.js       # 所有 JavaScript 邏輯
```

### 架構原則

- **關注點分離**：HTML 負責結構，CSS 負責樣式，JavaScript 負責行為
- **無依賴**：不使用任何外部框架或函式庫
- **客戶端儲存**：使用 localStorage API 進行資料持久化
- **事件驅動**：使用 DOM 事件處理使用者互動

## 元件與介面

### HTML 結構

**主要容器**：
- `<div class="container">` - 主要應用程式容器
  - `<h1>` - 標題「個人記帳本」
  - `<div class="total-display">` - 今日總計顯示區域
  - `<div class="input-section">` - 輸入區域
    - `<input id="amountInput" type="number">` - 金額輸入欄位
    - `<select id="categorySelect">` - 類別下拉選單
    - `<button id="addBtn">` - 新增按鈕
  - `<div id="expenseList">` - 支出記錄清單容器

**類別選項**：
```html
<option value="飲食">飲食</option>
<option value="交通">交通</option>
<option value="娛樂">娛樂</option>
```

### CSS 樣式設計

**顏色方案**：
- 背景色：淺灰色 (#f5f5f5 或類似)
- 按鈕色：綠色 (#4CAF50 或類似)
- 文字色：深灰色 (#333 或類似)

**響應式設計**：
- 使用媒體查詢 `@media (max-width: 768px)` 調整行動裝置佈局
- 在小螢幕上調整容器寬度、字體大小和間距
- 確保按鈕和輸入欄位在觸控裝置上易於點擊

**樣式特性**：
- 圓角：使用 `border-radius` 為按鈕和輸入欄位添加圓角
- 間距：使用 `margin` 和 `padding` 確保元素之間有適當的空間
- 陰影：可選擇性地使用 `box-shadow` 增加深度感

### JavaScript 模組

**資料結構**：
```javascript
// 支出記錄物件
{
  id: string,          // 唯一識別碼（使用 Date.now() 或 UUID）
  amount: number,      // 金額（正數）
  category: string     // 類別（飲食/交通/娛樂）
}
```

**核心函式**：

1. **初始化函式** (`init()`)
   - 從 localStorage 載入資料
   - 渲染現有記錄
   - 綁定事件監聽器
   - 更新今日總計

2. **新增支出** (`addExpense()`)
   - 驗證輸入（金額 > 0 且非空）
   - 建立新的支出記錄物件
   - 更新 localStorage
   - 渲染新記錄到 DOM
   - 清空輸入欄位
   - 更新今日總計

3. **刪除支出** (`deleteExpense(id)`)
   - 從資料陣列中移除指定記錄
   - 更新 localStorage
   - 從 DOM 中移除元素
   - 更新今日總計

4. **渲染記錄** (`renderExpense(expense)`)
   - 建立 DOM 元素顯示「分類 - 金額 元」
   - 附加刪除按鈕
   - 綁定刪除事件監聽器
   - 插入到 expenseList 容器

5. **計算總計** (`calculateTotal()`)
   - 遍歷所有支出記錄
   - 計算金額總和
   - 更新顯示「今日總計：XXX 元」

6. **儲存到 localStorage** (`saveToLocalStorage()`)
   - 將支出記錄陣列序列化為 JSON
   - 使用 `localStorage.setItem()` 儲存

7. **從 localStorage 載入** (`loadFromLocalStorage()`)
   - 使用 `localStorage.getItem()` 讀取資料
   - 解析 JSON 為陣列
   - 處理空值或無效資料的情況

8. **驗證輸入** (`validateInput(amount)`)
   - 檢查金額是否為空
   - 檢查金額是否 <= 0
   - 返回布林值或錯誤訊息

## 資料模型

### 支出記錄陣列

```javascript
// 儲存在 localStorage 的資料結構
[
  {
    id: "1234567890",
    amount: 150,
    category: "飲食"
  },
  {
    id: "1234567891",
    amount: 50,
    category: "交通"
  }
]
```

### localStorage 鍵值

- **鍵名**：`"expenses"` 或 `"personalExpenseTracker"`
- **值**：JSON 字串化的支出記錄陣列

## 正確性屬性

*屬性是一種特徵或行為，應該在系統的所有有效執行中保持為真——本質上是關於系統應該做什麼的正式陳述。屬性作為人類可讀規範和機器可驗證正確性保證之間的橋樑。*


### 屬性 1：新增有效記錄增加清單長度

*對於任何*有效的金額（> 0）和類別，新增支出記錄後，清單中的記錄數量應該增加 1

**驗證需求：4.1**

### 屬性 2：顯示格式正確性

*對於任何*支出記錄，顯示的文字應該包含類別、金額和「元」字，並符合「分類 - 金額 元」的格式

**驗證需求：4.2**

### 屬性 3：拒絕無效金額

*對於任何*小於或等於零的金額，嘗試新增時系統應該拒絕並保持清單不變

**驗證需求：4.3**

### 屬性 4：成功新增後清空輸入

*對於任何*有效的支出記錄，成功新增後，金額輸入欄位應該被清空，類別下拉選單應該重置為第一個選項

**驗證需求：4.5, 4.6**

### 屬性 5：localStorage 往返一致性

*對於任何*支出記錄陣列，儲存到 localStorage 後再載入，應該得到相同的資料（保留金額和類別資訊）

**驗證需求：5.5**

### 屬性 6：新增操作立即持久化

*對於任何*新增的支出記錄，localStorage 中應該立即包含該記錄

**驗證需求：5.1**

### 屬性 7：刪除操作同步更新

*對於任何*被刪除的支出記錄，該記錄應該從顯示清單、資料陣列和 localStorage 中同時移除

**驗證需求：6.2, 6.3, 5.4**

### 屬性 8：每筆記錄都有刪除按鈕

*對於任何*顯示在清單中的支出記錄，都應該有一個對應的刪除按鈕

**驗證需求：6.1**

### 屬性 9：今日總計計算正確性

*對於任何*支出記錄集合，今日總計應該等於所有記錄金額的總和，不論類別

**驗證需求：7.6, 7.2**

### 屬性 10：新增和刪除後總計即時更新

*對於任何*新增或刪除操作，今日總計應該立即反映最新的金額總和

**驗證需求：7.3, 6.4**

### 屬性 11：頁面載入時正確顯示資料

*對於任何*儲存在 localStorage 中的支出記錄集合，頁面載入後應該顯示所有記錄並計算正確的總計

**驗證需求：5.2, 5.3, 7.2**

## 錯誤處理

### 輸入驗證錯誤

- **空值輸入**：當金額欄位為空時，顯示警告訊息「請輸入金額」
- **無效金額**：當金額 <= 0 時，顯示警告訊息「金額必須大於 0」
- **非數字輸入**：HTML5 的 `type="number"` 會自動處理，但 JavaScript 應該額外驗證 `isNaN()`

### localStorage 錯誤

- **讀取失敗**：如果 localStorage 不可用或讀取失敗，初始化為空陣列
- **解析錯誤**：如果 JSON 解析失敗，清空 localStorage 並初始化為空陣列
- **儲存失敗**：如果 localStorage 已滿或不可用，顯示錯誤訊息給使用者

### DOM 操作錯誤

- **元素不存在**：在操作 DOM 元素前檢查元素是否存在
- **事件綁定失敗**：確保在 DOM 完全載入後才綁定事件（使用 `DOMContentLoaded`）

## 測試策略

### 雙重測試方法

本專案將採用**單元測試**和**屬性測試**的組合方式，以確保全面的測試覆蓋率：

- **單元測試**：驗證特定範例、邊界情況和錯誤條件
  - 測試空清單時顯示「今日總計：0 元」
  - 測試空值輸入被拒絕
  - 測試特定的 DOM 元素存在（如按鈕、輸入欄位）
  - 測試響應式設計在特定視窗寬度下的行為

- **屬性測試**：驗證跨所有輸入的通用屬性
  - 使用隨機生成的金額和類別測試新增功能
  - 測試任意數量的記錄的總計計算
  - 測試 localStorage 往返一致性
  - 測試刪除操作對任意記錄的影響

### 測試工具選擇

由於本專案不使用任何外部套件或建置工具，測試將採用以下方式：

1. **手動測試**：在瀏覽器中進行功能測試
2. **瀏覽器開發者工具**：使用 Console 進行 JavaScript 函式測試
3. **可選的測試框架**（如果允許開發依賴）：
   - Jest 或 Mocha 用於單元測試
   - fast-check（JavaScript）用於屬性測試

### 屬性測試配置

如果實作屬性測試：
- 每個屬性測試至少執行 100 次迭代
- 每個測試應該標記對應的設計文件屬性
- 標記格式：**Feature: personal-expense-tracker, Property {編號}: {屬性文字}**

### 測試覆蓋範圍

**核心功能測試**：
- 新增支出記錄（有效和無效輸入）
- 刪除支出記錄
- 計算今日總計
- localStorage 持久化和載入

**UI 測試**：
- DOM 元素存在性
- 顯示格式正確性
- 響應式設計

**整合測試**：
- 新增 → 顯示 → 持久化的完整流程
- 刪除 → 更新顯示 → 更新 localStorage 的完整流程
- 頁面重新載入 → 載入資料 → 顯示的完整流程

### 測試平衡建議

- 避免撰寫過多的單元測試 - 屬性測試已經涵蓋大量輸入組合
- 單元測試應該專注於：
  - 特定的邊界情況（空清單、空輸入）
  - 特定的範例（驗證基本功能運作）
  - DOM 元素的存在性檢查
- 屬性測試應該專注於：
  - 通用的正確性屬性（總計計算、往返一致性）
  - 跨所有輸入的行為驗證
