<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>個人記帳本 - 單元測試</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 5px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>個人記帳本 - DOM 元素存在性測試</h1>
    <div id="test-results"></div>
    <div id="test-summary" class="summary"></div>

    <!-- 載入主應用程式的 HTML 結構 -->
    <iframe id="app-frame" src="index.html" style="display: none;"></iframe>

    <script>
        // 測試框架
        const testResults = [];
        
        function assert(condition, testName) {
            const result = {
                name: testName,
                passed: condition
            };
            testResults.push(result);
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${condition ? 'pass' : 'fail'}`;
            resultDiv.textContent = `${condition ? '✓' : '✗'} ${testName}`;
            document.getElementById('test-results').appendChild(resultDiv);
        }

        function assertEqual(actual, expected, testName) {
            const condition = actual === expected;
            assert(condition, `${testName} (期望: ${expected}, 實際: ${actual})`);
        }

        function runTests() {
            const iframe = document.getElementById('app-frame');
            const doc = iframe.contentDocument || iframe.contentWindow.document;

            console.log('開始執行 DOM 元素存在性測試...');

            // 測試 1: 檢查 amountInput 元素是否存在
            const amountInput = doc.getElementById('amountInput');
            assert(amountInput !== null, '測試 1: amountInput 元素存在');

            // 測試 2: 檢查 amountInput 的 type 屬性
            if (amountInput) {
                assertEqual(amountInput.type, 'number', '測試 2: amountInput 的 type 為 number');
            }

            // 測試 3: 檢查 categorySelect 元素是否存在
            const categorySelect = doc.getElementById('categorySelect');
            assert(categorySelect !== null, '測試 3: categorySelect 元素存在');

            // 測試 4: 檢查 categorySelect 包含三個選項
            if (categorySelect) {
                const options = categorySelect.options;
                assertEqual(options.length, 3, '測試 4: categorySelect 包含 3 個選項');

                // 測試 5-7: 檢查三個類別選項的值
                if (options.length >= 3) {
                    assertEqual(options[0].value, '飲食', '測試 5: 第一個選項為「飲食」');
                    assertEqual(options[1].value, '交通', '測試 6: 第二個選項為「交通」');
                    assertEqual(options[2].value, '娛樂', '測試 7: 第三個選項為「娛樂」');
                }
            }

            // 測試 8: 檢查 addBtn 元素是否存在
            const addBtn = doc.getElementById('addBtn');
            assert(addBtn !== null, '測試 8: addBtn 元素存在');

            // 測試 9: 檢查 expenseList 元素是否存在
            const expenseList = doc.getElementById('expenseList');
            assert(expenseList !== null, '測試 9: expenseList 元素存在');

            // 測試 10: 檢查標題是否存在
            const title = doc.querySelector('h1');
            assert(title !== null, '測試 10: 標題元素存在');
            if (title) {
                assertEqual(title.textContent, '個人記帳本', '測試 11: 標題文字為「個人記帳本」');
            }

            // 測試 12: 檢查今日總計顯示元素是否存在
            const totalDisplay = doc.querySelector('.total-display');
            assert(totalDisplay !== null, '測試 12: 今日總計顯示區域存在');

            // 測試 13: 檢查 CSS 檔案是否正確引用
            const cssLink = doc.querySelector('link[rel="stylesheet"]');
            assert(cssLink !== null, '測試 13: CSS 檔案引用存在');
            if (cssLink) {
                assertEqual(cssLink.getAttribute('href'), 'style.css', '測試 14: CSS 檔案路徑正確');
            }

            // 測試 15: 檢查 JavaScript 檔案是否正確引用
            const scriptTag = doc.querySelector('script[src]');
            assert(scriptTag !== null, '測試 15: JavaScript 檔案引用存在');
            if (scriptTag) {
                assertEqual(scriptTag.getAttribute('src'), 'script.js', '測試 16: JavaScript 檔案路徑正確');
            }

            // 顯示測試摘要
            displaySummary();
        }

        function displaySummary() {
            const passed = testResults.filter(r => r.passed).length;
            const failed = testResults.filter(r => !r.passed).length;
            const total = testResults.length;

            const summaryDiv = document.getElementById('test-summary');
            summaryDiv.innerHTML = `
                <div>測試總數: ${total}</div>
                <div style="color: #155724;">通過: ${passed}</div>
                <div style="color: #721c24;">失敗: ${failed}</div>
                <div style="margin-top: 10px;">
                    ${failed === 0 ? '✓ 所有測試通過！' : '✗ 有測試失敗，請檢查上方結果'}
                </div>
            `;
        }

        // 等待 iframe 載入完成後執行測試
        window.addEventListener('load', function() {
            const iframe = document.getElementById('app-frame');
            iframe.addEventListener('load', function() {
                setTimeout(runTests, 100); // 給一點時間確保完全載入
            });
        });
    </script>
</body>
</html>
